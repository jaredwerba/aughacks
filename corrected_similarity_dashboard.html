<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corrected EEG Similarity Analysis</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .container { max-width: 1800px; margin: 0 auto; padding: 20px; }
        .header { background: rgba(255,255,255,0.95); border-radius: 20px; padding: 30px; margin-bottom: 30px; text-align: center; }
        .header h1 { color: #667eea; font-size: 2.5em; margin-bottom: 10px; }
        .problem-explanation { background: #fff3cd; border-left: 4px solid #ffc107; padding: 20px; margin: 20px 0; border-radius: 5px; }
        .solution-explanation { background: #d4edda; border-left: 4px solid #28a745; padding: 20px; margin: 20px 0; border-radius: 5px; }
        .controls { background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        .viz-section { background: rgba(255,255,255,0.95); border-radius: 20px; padding: 25px; margin-bottom: 25px; }
        .section-title { font-size: 1.5em; font-weight: 600; color: #667eea; margin-bottom: 20px; }
        .viz-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 25px; }
        .viz-container { background: #f8f9fa; border-radius: 10px; padding: 20px; }
        .viz-title { font-size: 1.1em; font-weight: 600; margin-bottom: 15px; text-align: center; }
        .stats-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .stats-table th, .stats-table td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        .stats-table th { background: #f8f9fa; font-weight: 600; }
        .control-group { margin-bottom: 15px; }
        .control-group select { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-brain"></i> Corrected EEG Similarity Analysis</h1>
            <p>Fixed Temporal Structure & Proper Fragment Distribution</p>
        </div>
        
        <div class="problem-explanation">
            <h3>üö® Problem Identified:</h3>
            <p><strong>Issue:</strong> Previous similarity matrices were averaging all fragments per video into single points, losing temporal structure.</p>
            <p><strong>Result:</strong> Videos with different durations appeared as "chunks" of different sizes instead of equidistant points.</p>
            <p><strong>Root Cause:</strong> <code>np.mean(video_embs, axis=0)</code> collapsed temporal dimension.</p>
        </div>
        
        <div class="solution-explanation">
            <h3>‚úÖ Solution Implemented:</h3>
            <p><strong>Corrected Approach:</strong> Maintain temporal structure while providing meaningful video-level comparisons.</p>
            <p><strong>New Features:</strong></p>
            <ul>
                <li>üéØ <strong>Video-level similarity</strong>: Proper averaging with fragment count awareness</li>
                <li>‚è±Ô∏è <strong>Temporal consistency analysis</strong>: How similar consecutive fragments are</li>
                <li>üìä <strong>Fragment distribution visualization</strong>: Clear view of temporal structure</li>
                <li>üîç <strong>Self-similarity analysis</strong>: Internal coherence per video</li>
            </ul>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label><i class="fas fa-database"></i> Database:</label>
                <select id="database-select" onchange="updateAnalysis()">
                    <option value="video_embeddings_5s">5s Fragments (High Resolution)</option>
<option value="video_embeddings_20s">20s Fragments (Medium Resolution)</option>
<option value="video_embeddings">Full Videos (Global Analysis)</option>
                </select>
            </div>
        </div>
        
        <div class="viz-section">
            <div class="section-title"><i class="fas fa-table"></i> Fragment Distribution Analysis</div>
            <div id="fragment-distribution-table"></div>
        </div>
        
        <div class="viz-section">
            <div class="section-title"><i class="fas fa-chart-line"></i> Corrected Similarity Matrices</div>
            <div class="viz-grid">
                <div class="viz-container">
                    <div class="viz-title">üéØ Video-to-Video Similarity (Corrected)</div>
                    <div id="corrected-similarity-plot"></div>
                </div>
                <div class="viz-container">
                    <div class="viz-title">‚è±Ô∏è Temporal Consistency Analysis</div>
                    <div id="temporal-consistency-plot"></div>
                </div>
            </div>
        </div>
        
        <div class="viz-section">
            <div class="section-title"><i class="fas fa-microscope"></i> Fragment Structure Analysis</div>
            <div class="viz-grid">
                <div class="viz-container">
                    <div class="viz-title">üìä Fragment Count Distribution</div>
                    <div id="fragment-count-plot"></div>
                </div>
                <div class="viz-container">
                    <div class="viz-title">üîç Self-Similarity Statistics</div>
                    <div id="self-similarity-plot"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const analysisData = {
  "video_embeddings_5s": {
    "video_info": {
      "lsl_stream_20250809_154545": {
        "indices": [
          0,
          1,
          2,
          3,
          4,
          5,
          6,
          7,
          8,
          9,
          10,
          11,
          12,
          13,
          14,
          15,
          16,
          17,
          18,
          19,
          20,
          21,
          22,
          23,
          24,
          25,
          26,
          27,
          28,
          29,
          30,
          31,
          32,
          33,
          34,
          35,
          36,
          37,
          38,
          39,
          40,
          41,
          42,
          43,
          44,
          45,
          46,
          47,
          48,
          49,
          50,
          51,
          52,
          53,
          54,
          55,
          56,
          57,
          58,
          59,
          60,
          61,
          62,
          63,
          64,
          65,
          66,
          67,
          68,
          69,
          70,
          71,
          72,
          73,
          74,
          75,
          76,
          77,
          78,
          79,
          80,
          81,
          82,
          83,
          84,
          85,
          86,
          87,
          88,
          89,
          90,
          91,
          92,
          93,
          94,
          95,
          96,
          97,
          98,
          99,
          100,
          101,
          102,
          103,
          104,
          105
        ],
        "fragment_count": 106,
        "total_duration": 530.0,
        "video_short": "154545"
      },
      "lsl_stream_20250809_155123": {
        "indices": [
          106,
          107,
          108,
          109,
          110,
          111,
          112,
          113,
          114,
          115,
          116,
          117,
          118,
          119,
          120,
          121,
          122,
          123,
          124,
          125,
          126,
          127,
          128,
          129,
          130,
          131,
          132,
          133,
          134,
          135,
          136,
          137,
          138,
          139,
          140,
          141,
          142,
          143,
          144,
          145,
          146,
          147,
          148,
          149,
          150,
          151,
          152,
          153,
          154,
          155,
          156,
          157,
          158,
          159,
          160,
          161,
          162,
          163,
          164,
          165,
          166,
          167,
          168,
          169,
          170,
          171,
          172,
          173,
          174,
          175,
          176,
          177,
          178,
          179,
          180,
          181,
          182,
          183,
          184,
          185,
          186,
          187,
          188,
          189,
          190,
          191,
          192,
          193,
          194,
          195,
          196,
          197,
          198,
          199,
          200,
          201,
          202,
          203,
          204,
          205,
          206,
          207,
          208,
          209,
          210,
          211,
          212,
          213,
          214,
          215
        ],
        "fragment_count": 110,
        "total_duration": 550.0,
        "video_short": "155123"
      },
      "lsl_stream_20250809_155739": {
        "indices": [
          216,
          217,
          218,
          219,
          220,
          221,
          222,
          223,
          224,
          225,
          226,
          227,
          228,
          229,
          230,
          231,
          232,
          233,
          234,
          235,
          236,
          237,
          238,
          239,
          240,
          241,
          242,
          243,
          244,
          245,
          246,
          247,
          248,
          249,
          250,
          251,
          252,
          253,
          254,
          255,
          256,
          257,
          258,
          259,
          260,
          261,
          262,
          263,
          264,
          265,
          266,
          267,
          268,
          269,
          270,
          271,
          272,
          273,
          274,
          275,
          276,
          277,
          278,
          279,
          280,
          281,
          282,
          283,
          284,
          285,
          286,
          287,
          288,
          289,
          290,
          291,
          292,
          293,
          294,
          295,
          296,
          297,
          298,
          299,
          300,
          301,
          302,
          303,
          304,
          305,
          306,
          307,
          308,
          309,
          310,
          311,
          312,
          313,
          314,
          315,
          316,
          317,
          318,
          319,
          320,
          321,
          322,
          323
        ],
        "fragment_count": 108,
        "total_duration": 540.0,
        "video_short": "155739"
      },
      "lsl_stream_20250809_160350": {
        "indices": [
          324,
          325,
          326,
          327,
          328,
          329,
          330,
          331,
          332,
          333,
          334,
          335,
          336,
          337,
          338,
          339,
          340,
          341,
          342,
          343,
          344,
          345,
          346,
          347,
          348,
          349,
          350,
          351,
          352,
          353,
          354,
          355,
          356,
          357,
          358,
          359,
          360,
          361,
          362,
          363,
          364,
          365,
          366,
          367,
          368,
          369,
          370,
          371,
          372,
          373,
          374,
          375,
          376,
          377,
          378,
          379,
          380,
          381,
          382,
          383,
          384,
          385,
          386,
          387,
          388,
          389,
          390,
          391,
          392,
          393,
          394,
          395,
          396,
          397,
          398,
          399,
          400,
          401,
          402,
          403,
          404,
          405,
          406,
          407,
          408,
          409,
          410,
          411,
          412,
          413,
          414,
          415,
          416,
          417,
          418,
          419,
          420,
          421,
          422,
          423,
          424,
          425,
          426,
          427,
          428,
          429,
          430
        ],
        "fragment_count": 107,
        "total_duration": 535.0,
        "video_short": "160350"
      },
      "lsl_stream_20250809_173815": {
        "indices": [
          431,
          432,
          433,
          434,
          435,
          436,
          437,
          438,
          439,
          440,
          441,
          442,
          443,
          444,
          445,
          446,
          447,
          448,
          449,
          450,
          451,
          452,
          453,
          454,
          455,
          456,
          457,
          458,
          459,
          460,
          461,
          462,
          463,
          464,
          465,
          466,
          467,
          468,
          469,
          470,
          471,
          472,
          473,
          474,
          475,
          476,
          477,
          478,
          479,
          480,
          481,
          482,
          483,
          484,
          485,
          486,
          487,
          488,
          489,
          490,
          491,
          492,
          493,
          494,
          495,
          496,
          497
        ],
        "fragment_count": 67,
        "total_duration": 335.0,
        "video_short": "173815"
      },
      "lsl_stream_20250809_174138": {
        "indices": [
          498,
          499,
          500,
          501,
          502,
          503,
          504,
          505,
          506,
          507,
          508,
          509,
          510,
          511,
          512,
          513,
          514,
          515,
          516,
          517,
          518,
          519,
          520,
          521,
          522,
          523,
          524,
          525,
          526,
          527,
          528,
          529,
          530,
          531,
          532,
          533,
          534,
          535,
          536,
          537,
          538,
          539,
          540,
          541,
          542,
          543,
          544,
          545,
          546,
          547,
          548,
          549,
          550,
          551,
          552,
          553,
          554,
          555,
          556,
          557,
          558,
          559,
          560,
          561,
          562,
          563,
          564,
          565,
          566,
          567,
          568,
          569,
          570,
          571,
          572,
          573,
          574,
          575,
          576,
          577,
          578,
          579,
          580,
          581,
          582,
          583,
          584,
          585,
          586,
          587,
          588,
          589,
          590,
          591,
          592,
          593,
          594,
          595,
          596,
          597,
          598,
          599,
          600,
          601,
          602,
          603,
          604,
          605,
          606,
          607,
          608,
          609,
          610,
          611,
          612,
          613,
          614,
          615,
          616
        ],
        "fragment_count": 119,
        "total_duration": 595.0,
        "video_short": "174138"
      },
      "lsl_stream_20250809_174635": {
        "indices": [
          617,
          618,
          619,
          620,
          621,
          622,
          623,
          624,
          625,
          626,
          627,
          628,
          629,
          630,
          631,
          632,
          633,
          634,
          635,
          636,
          637,
          638,
          639,
          640,
          641,
          642,
          643,
          644,
          645,
          646,
          647,
          648,
          649,
          650,
          651,
          652,
          653,
          654,
          655,
          656,
          657,
          658,
          659,
          660,
          661,
          662,
          663,
          664,
          665,
          666,
          667,
          668,
          669,
          670,
          671,
          672,
          673,
          674,
          675,
          676,
          677,
          678,
          679,
          680,
          681,
          682,
          683,
          684,
          685,
          686,
          687,
          688,
          689,
          690,
          691,
          692,
          693,
          694,
          695,
          696,
          697,
          698,
          699,
          700,
          701,
          702,
          703,
          704,
          705,
          706,
          707,
          708,
          709,
          710,
          711,
          712,
          713,
          714,
          715,
          716,
          717,
          718,
          719,
          720,
          721,
          722,
          723,
          724,
          725,
          726,
          727,
          728,
          729,
          730,
          731,
          732,
          733,
          734,
          735
        ],
        "fragment_count": 119,
        "total_duration": 595.0,
        "video_short": "174635"
      },
      "lsl_stream_20250809_175111": {
        "indices": [
          736,
          737,
          738,
          739,
          740,
          741,
          742,
          743,
          744,
          745,
          746,
          747,
          748,
          749,
          750,
          751,
          752,
          753,
          754,
          755,
          756,
          757,
          758,
          759,
          760,
          761,
          762,
          763,
          764,
          765,
          766,
          767,
          768,
          769,
          770,
          771,
          772,
          773,
          774,
          775,
          776,
          777,
          778,
          779,
          780,
          781,
          782,
          783,
          784,
          785,
          786,
          787,
          788,
          789,
          790,
          791,
          792,
          793,
          794,
          795,
          796,
          797,
          798,
          799,
          800,
          801,
          802,
          803,
          804,
          805,
          806,
          807,
          808,
          809,
          810,
          811,
          812,
          813,
          814,
          815,
          816,
          817,
          818,
          819,
          820,
          821,
          822,
          823,
          824,
          825,
          826,
          827,
          828,
          829,
          830,
          831,
          832,
          833,
          834,
          835,
          836,
          837,
          838,
          839,
          840,
          841,
          842,
          843,
          844,
          845,
          846,
          847,
          848,
          849,
          850,
          851,
          852,
          853,
          854
        ],
        "fragment_count": 119,
        "total_duration": 595.0,
        "video_short": "175111"
      },
      "lsl_stream_20250809_175524": {
        "indices": [
          855,
          856,
          857,
          858,
          859,
          860,
          861,
          862,
          863,
          864,
          865,
          866,
          867,
          868,
          869,
          870,
          871,
          872,
          873,
          874,
          875,
          876
        ],
        "fragment_count": 22,
        "total_duration": 110.0,
        "video_short": "175524"
      },
      "lsl_stream_20250809_175632": {
        "indices": [
          877,
          878,
          879,
          880,
          881,
          882,
          883,
          884,
          885,
          886,
          887,
          888,
          889,
          890,
          891,
          892,
          893,
          894,
          895,
          896,
          897,
          898,
          899,
          900,
          901,
          902,
          903,
          904,
          905,
          906,
          907,
          908,
          909,
          910,
          911,
          912,
          913,
          914,
          915,
          916,
          917,
          918,
          919,
          920,
          921,
          922,
          923,
          924,
          925,
          926,
          927,
          928,
          929,
          930,
          931,
          932,
          933,
          934,
          935,
          936,
          937,
          938,
          939,
          940,
          941,
          942,
          943,
          944,
          945,
          946,
          947,
          948,
          949,
          950,
          951,
          952,
          953,
          954,
          955,
          956,
          957,
          958,
          959,
          960,
          961,
          962,
          963,
          964,
          965,
          966,
          967,
          968,
          969,
          970,
          971,
          972,
          973,
          974,
          975,
          976,
          977,
          978,
          979,
          980,
          981,
          982,
          983,
          984,
          985,
          986,
          987,
          988,
          989,
          990,
          991,
          992,
          993,
          994,
          995
        ],
        "fragment_count": 119,
        "total_duration": 595.0,
        "video_short": "175632"
      }
    },
    "video_ids": [
      "lsl_stream_20250809_154545",
      "lsl_stream_20250809_155123",
      "lsl_stream_20250809_155739",
      "lsl_stream_20250809_160350",
      "lsl_stream_20250809_173815",
      "lsl_stream_20250809_174138",
      "lsl_stream_20250809_174635",
      "lsl_stream_20250809_175111",
      "lsl_stream_20250809_175524",
      "lsl_stream_20250809_175632"
    ],
    "video_short_names": [
      "154545",
      "155123",
      "155739",
      "160350",
      "173815",
      "174138",
      "174635",
      "175111",
      "175524",
      "175632"
    ],
    "full_similarity_matrix": "[[1.0000001  0.9859726  0.9367292  ... 0.11691345 0.11714967 0.1167155 ]\n [0.9859726  1.         0.89455134 ... 0.20212954 0.2021543  0.20177503]\n [0.9367292  0.89455134 1.0000001  ... 0.02793027 0.02842885 0.02792683]\n ...\n [0.11691345 0.20212954 0.02793027 ... 1.         0.99997026 0.9999907 ]\n [0.11714967 0.2021543  0.02842885 ... 0.99997026 1.         0.9999886 ]\n [0.1167155  0.20177503 0.02792683 ... 0.9999907  0.9999886  0.99999994]]",
    "video_similarity_matrix": [
      [
        1.0,
        0.07110585272312164,
        0.7733588218688965,
        0.99517822265625,
        0.06177026033401489,
        0.053389184176921844,
        0.8781070113182068,
        0.9116469621658325,
        0.8503531217575073,
        0.8464294075965881
      ],
      [
        0.07110585272312164,
        1.0,
        0.07775763422250748,
        0.0705147460103035,
        0.9563589692115784,
        0.8725154399871826,
        0.3304694592952728,
        0.3203081786632538,
        0.3124823570251465,
        0.31244006752967834
      ],
      [
        0.7733588218688965,
        0.07775763422250748,
        0.9999998807907104,
        0.7106890082359314,
        0.0663815587759018,
        0.05210186168551445,
        0.6454190611839294,
        0.6610457301139832,
        0.6447235345840454,
        0.6433972120285034
      ],
      [
        0.99517822265625,
        0.0705147460103035,
        0.7106890082359314,
        1.0,
        0.060890041291713715,
        0.052915308624506,
        0.8870773315429688,
        0.9195735454559326,
        0.8566709160804749,
        0.8526830673217773
      ],
      [
        0.06177026033401489,
        0.9563589692115784,
        0.0663815587759018,
        0.060890041291713715,
        0.9999998807907104,
        0.9770084023475647,
        0.24052292108535767,
        0.26497703790664673,
        0.2407309114933014,
        0.24048425257205963
      ],
      [
        0.053389184176921844,
        0.8725154399871826,
        0.05210186168551445,
        0.052915308624506,
        0.9770084023475647,
        0.9999999403953552,
        0.1683310717344284,
        0.21584314107894897,
        0.1828683614730835,
        0.18260805308818817
      ],
      [
        0.8781070113182068,
        0.3304694592952728,
        0.6454190611839294,
        0.8870773315429688,
        0.24052292108535767,
        0.1683310717344284,
        0.9999999403953552,
        0.9700411558151245,
        0.9663946628570557,
        0.9657189846038818
      ],
      [
        0.9116469621658325,
        0.3203081786632538,
        0.6610457301139832,
        0.9195735454559326,
        0.26497703790664673,
        0.21584314107894897,
        0.9700411558151245,
        1.0,
        0.9848669171333313,
        0.9832014441490173
      ],
      [
        0.8503531217575073,
        0.3124823570251465,
        0.6447235345840454,
        0.8566709160804749,
        0.2407309114933014,
        0.1828683614730835,
        0.9663946628570557,
        0.9848669171333313,
        1.0,
        0.9999489784240723
      ],
      [
        0.8464294075965881,
        0.31244006752967834,
        0.6433972120285034,
        0.8526830673217773,
        0.24048425257205963,
        0.18260805308818817,
        0.9657189846038818,
        0.9832014441490173,
        0.9999489784240723,
        1.0000001192092896
      ]
    ],
    "temporal_analysis": {
      "lsl_stream_20250809_154545": {
        "fragment_count": 106,
        "avg_consecutive_similarity": "0.9435326",
        "temporal_consistency": "0.100793235",
        "avg_self_similarity": "0.91251314",
        "similarity_range": [
          "0.046623014",
          "1.0000004"
        ]
      },
      "lsl_stream_20250809_155123": {
        "fragment_count": 110,
        "avg_consecutive_similarity": "0.9142171",
        "temporal_consistency": "0.18573079",
        "avg_self_similarity": "0.86869806",
        "similarity_range": [
          "0.0016362644",
          "1.0000002"
        ]
      },
      "lsl_stream_20250809_155739": {
        "fragment_count": 108,
        "avg_consecutive_similarity": "0.9476025",
        "temporal_consistency": "0.06516447",
        "avg_self_similarity": "0.8920237",
        "similarity_range": [
          "0.22528426",
          "1.0000004"
        ]
      },
      "lsl_stream_20250809_160350": {
        "fragment_count": 107,
        "avg_consecutive_similarity": "0.9651367",
        "temporal_consistency": "0.08976855",
        "avg_self_similarity": "0.93735904",
        "similarity_range": [
          "0.01866239",
          "1.0000002"
        ]
      },
      "lsl_stream_20250809_173815": {
        "fragment_count": 67,
        "avg_consecutive_similarity": "0.8488174",
        "temporal_consistency": "0.21845257",
        "avg_self_similarity": "0.69182366",
        "similarity_range": [
          "0.01218725",
          "1.0000002"
        ]
      },
      "lsl_stream_20250809_174138": {
        "fragment_count": 119,
        "avg_consecutive_similarity": "0.77219415",
        "temporal_consistency": "0.26467106",
        "avg_self_similarity": "0.6293872",
        "similarity_range": [
          "0.011432489",
          "1.0000002"
        ]
      },
      "lsl_stream_20250809_174635": {
        "fragment_count": 119,
        "avg_consecutive_similarity": "0.8974066",
        "temporal_consistency": "0.17745835",
        "avg_self_similarity": "0.45295444",
        "similarity_range": [
          "0.001437256",
          "1.0000002"
        ]
      },
      "lsl_stream_20250809_175111": {
        "fragment_count": 119,
        "avg_consecutive_similarity": "0.973015",
        "temporal_consistency": "0.072623186",
        "avg_self_similarity": "0.9581437",
        "similarity_range": [
          "0.50868917",
          "1.0000002"
        ]
      },
      "lsl_stream_20250809_175524": {
        "fragment_count": 22,
        "avg_consecutive_similarity": "0.999136",
        "temporal_consistency": "0.0019667004",
        "avg_self_similarity": "0.9988221",
        "similarity_range": [
          "0.9903295",
          "1.0000001"
        ]
      },
      "lsl_stream_20250809_175632": {
        "fragment_count": 119,
        "avg_consecutive_similarity": "0.9997741",
        "temporal_consistency": "0.0007914914",
        "avg_self_similarity": "0.99974173",
        "similarity_range": [
          "0.99403745",
          "1.0000002"
        ]
      }
    },
    "fragment_count": 996
  },
  "video_embeddings_20s": {
    "video_info": {
      "lsl_stream_20250809_154545": {
        "indices": [
          0,
          1,
          2,
          3,
          4,
          5,
          6,
          7,
          8,
          9,
          10,
          11,
          12,
          13,
          14,
          15,
          16,
          17,
          18,
          19,
          20,
          21,
          22,
          23,
          24,
          25
        ],
        "fragment_count": 26,
        "total_duration": 520.0,
        "video_short": "154545"
      },
      "lsl_stream_20250809_155123": {
        "indices": [
          26,
          27,
          28,
          29,
          30,
          31,
          32,
          33,
          34,
          35,
          36,
          37,
          38,
          39,
          40,
          41,
          42,
          43,
          44,
          45,
          46,
          47,
          48,
          49,
          50,
          51,
          52
        ],
        "fragment_count": 27,
        "total_duration": 540.0,
        "video_short": "155123"
      },
      "lsl_stream_20250809_155739": {
        "indices": [
          53,
          54,
          55,
          56,
          57,
          58,
          59,
          60,
          61,
          62,
          63,
          64,
          65,
          66,
          67,
          68,
          69,
          70,
          71,
          72,
          73,
          74,
          75,
          76,
          77,
          78,
          79
        ],
        "fragment_count": 27,
        "total_duration": 540.0,
        "video_short": "155739"
      },
      "lsl_stream_20250809_160350": {
        "indices": [
          80,
          81,
          82,
          83,
          84,
          85,
          86,
          87,
          88,
          89,
          90,
          91,
          92,
          93,
          94,
          95,
          96,
          97,
          98,
          99,
          100,
          101,
          102,
          103,
          104,
          105
        ],
        "fragment_count": 26,
        "total_duration": 520.0,
        "video_short": "160350"
      },
      "lsl_stream_20250809_173815": {
        "indices": [
          106,
          107,
          108,
          109,
          110,
          111,
          112,
          113,
          114,
          115,
          116,
          117,
          118,
          119,
          120,
          121
        ],
        "fragment_count": 16,
        "total_duration": 320.0,
        "video_short": "173815"
      },
      "lsl_stream_20250809_174138": {
        "indices": [
          122,
          123,
          124,
          125,
          126,
          127,
          128,
          129,
          130,
          131,
          132,
          133,
          134,
          135,
          136,
          137,
          138,
          139,
          140,
          141,
          142,
          143,
          144,
          145,
          146,
          147,
          148,
          149,
          150
        ],
        "fragment_count": 29,
        "total_duration": 580.0,
        "video_short": "174138"
      },
      "lsl_stream_20250809_174635": {
        "indices": [
          151,
          152,
          153,
          154,
          155,
          156,
          157,
          158,
          159,
          160,
          161,
          162,
          163,
          164,
          165,
          166,
          167,
          168,
          169,
          170,
          171,
          172,
          173,
          174,
          175,
          176,
          177,
          178,
          179
        ],
        "fragment_count": 29,
        "total_duration": 580.0,
        "video_short": "174635"
      },
      "lsl_stream_20250809_175111": {
        "indices": [
          180,
          181,
          182,
          183,
          184,
          185,
          186,
          187,
          188,
          189,
          190,
          191,
          192,
          193,
          194,
          195,
          196,
          197,
          198,
          199,
          200,
          201,
          202,
          203,
          204,
          205,
          206,
          207,
          208
        ],
        "fragment_count": 29,
        "total_duration": 580.0,
        "video_short": "175111"
      },
      "lsl_stream_20250809_175524": {
        "indices": [
          209,
          210,
          211,
          212,
          213
        ],
        "fragment_count": 5,
        "total_duration": 100.0,
        "video_short": "175524"
      },
      "lsl_stream_20250809_175632": {
        "indices": [
          214,
          215,
          216,
          217,
          218,
          219,
          220,
          221,
          222,
          223,
          224,
          225,
          226,
          227,
          228,
          229,
          230,
          231,
          232,
          233,
          234,
          235,
          236,
          237,
          238,
          239,
          240,
          241,
          242
        ],
        "fragment_count": 29,
        "total_duration": 580.0,
        "video_short": "175632"
      }
    },
    "video_ids": [
      "lsl_stream_20250809_154545",
      "lsl_stream_20250809_155123",
      "lsl_stream_20250809_155739",
      "lsl_stream_20250809_160350",
      "lsl_stream_20250809_173815",
      "lsl_stream_20250809_174138",
      "lsl_stream_20250809_174635",
      "lsl_stream_20250809_175111",
      "lsl_stream_20250809_175524",
      "lsl_stream_20250809_175632"
    ],
    "video_short_names": [
      "154545",
      "155123",
      "155739",
      "160350",
      "173815",
      "174138",
      "174635",
      "175111",
      "175524",
      "175632"
    ],
    "full_similarity_matrix": "[[0.99999976 0.98896587 0.7704077  ... 0.11339425 0.11595052 0.11643387]\n [0.98896587 0.9999999  0.73818743 ... 0.20149046 0.20326094 0.20374046]\n [0.7704077  0.73818743 0.9999997  ... 0.07131689 0.07364941 0.0740499 ]\n ...\n [0.11339425 0.20149046 0.07131689 ... 0.9999999  0.9996061  0.99956214]\n [0.11595052 0.20326094 0.07364941 ... 0.9996061  1.0000001  0.99999803]\n [0.11643387 0.20374046 0.0740499  ... 0.99956214 0.99999803 1.        ]]",
    "video_similarity_matrix": [
      [
        0.9999998807907104,
        0.058812323957681656,
        0.6947638392448425,
        0.9509749412536621,
        0.0459442138671875,
        0.04905736446380615,
        0.7623412013053894,
        0.8145594596862793,
        0.7665855288505554,
        0.7654522657394409
      ],
      [
        0.058812323957681656,
        1.0,
        0.02751089632511139,
        0.06554900109767914,
        0.9547039270401001,
        0.8714622259140015,
        0.3259476125240326,
        0.3152827024459839,
        0.30546247959136963,
        0.30596625804901123
      ],
      [
        0.6947638392448425,
        0.02751089632511139,
        1.000000238418579,
        0.4478839933872223,
        0.039539583027362823,
        0.03061741404235363,
        0.23322823643684387,
        0.2721613049507141,
        0.3020502030849457,
        0.3021233379840851
      ],
      [
        0.9509749412536621,
        0.06554900109767914,
        0.4478839933872223,
        0.9999997615814209,
        0.046697355806827545,
        0.052195239812135696,
        0.866269052028656,
        0.9133334755897522,
        0.8442932367324829,
        0.8429152965545654
      ],
      [
        0.0459442138671875,
        0.9547039270401001,
        0.039539583027362823,
        0.046697355806827545,
        1.0,
        0.9760868549346924,
        0.22516128420829773,
        0.25201642513275146,
        0.22636355459690094,
        0.22684352099895477
      ],
      [
        0.04905736446380615,
        0.8714622259140015,
        0.03061741404235363,
        0.052195239812135696,
        0.9760868549346924,
        1.0,
        0.1654984951019287,
        0.2179757058620453,
        0.18162667751312256,
        0.1820565015077591
      ],
      [
        0.7623412013053894,
        0.3259476125240326,
        0.23322823643684387,
        0.866269052028656,
        0.22516128420829773,
        0.1654984951019287,
        1.0,
        0.9724535346031189,
        0.9594357013702393,
        0.9591079950332642
      ],
      [
        0.8145594596862793,
        0.3152827024459839,
        0.2721613049507141,
        0.9133334755897522,
        0.25201642513275146,
        0.2179757058620453,
        0.9724535346031189,
        0.9999999403953552,
        0.9767049551010132,
        0.9760904312133789
      ],
      [
        0.7665855288505554,
        0.30546247959136963,
        0.3020502030849457,
        0.8442932367324829,
        0.22636355459690094,
        0.18162667751312256,
        0.9594357013702393,
        0.9767049551010132,
        1.0,
        0.9999948143959045
      ],
      [
        0.7654522657394409,
        0.30596625804901123,
        0.3021233379840851,
        0.8429152965545654,
        0.22684352099895477,
        0.1820565015077591,
        0.9591079950332642,
        0.9760904312133789,
        0.9999948143959045,
        1.0
      ]
    ],
    "temporal_analysis": {
      "lsl_stream_20250809_154545": {
        "fragment_count": 26,
        "avg_consecutive_similarity": "0.9086209",
        "temporal_consistency": "0.19859701",
        "avg_self_similarity": "0.8910771",
        "similarity_range": [
          "0.2254701",
          "1.0000001"
        ]
      },
      "lsl_stream_20250809_155123": {
        "fragment_count": 27,
        "avg_consecutive_similarity": "0.8563423",
        "temporal_consistency": "0.29198474",
        "avg_self_similarity": "0.8476722",
        "similarity_range": [
          "0.002124964",
          "1.0000002"
        ]
      },
      "lsl_stream_20250809_155739": {
        "fragment_count": 27,
        "avg_consecutive_similarity": "0.95147145",
        "temporal_consistency": "0.08618047",
        "avg_self_similarity": "0.9178225",
        "similarity_range": [
          "0.59425646",
          "1.0000001"
        ]
      },
      "lsl_stream_20250809_160350": {
        "fragment_count": 26,
        "avg_consecutive_similarity": "0.9570909",
        "temporal_consistency": "0.16498958",
        "avg_self_similarity": "0.9235053",
        "similarity_range": [
          "0.10435328",
          "1.0000002"
        ]
      },
      "lsl_stream_20250809_173815": {
        "fragment_count": 16,
        "avg_consecutive_similarity": "0.8675696",
        "temporal_consistency": "0.19376701",
        "avg_self_similarity": "0.7447694",
        "similarity_range": [
          "0.050463706",
          "1.0000001"
        ]
      },
      "lsl_stream_20250809_174138": {
        "fragment_count": 29,
        "avg_consecutive_similarity": "0.82788455",
        "temporal_consistency": "0.2645872",
        "avg_self_similarity": "0.6934763",
        "similarity_range": [
          "0.039127965",
          "1.0000002"
        ]
      },
      "lsl_stream_20250809_174635": {
        "fragment_count": 29,
        "avg_consecutive_similarity": "0.8641543",
        "temporal_consistency": "0.2187928",
        "avg_self_similarity": "0.46968213",
        "similarity_range": [
          "0.0005625199",
          "1.0000001"
        ]
      },
      "lsl_stream_20250809_175111": {
        "fragment_count": 29,
        "avg_consecutive_similarity": "0.9734395",
        "temporal_consistency": "0.06761251",
        "avg_self_similarity": "0.96453273",
        "similarity_range": [
          "0.67612666",
          "1.0000002"
        ]
      },
      "lsl_stream_20250809_175524": {
        "fragment_count": 5,
        "avg_consecutive_similarity": "0.99989057",
        "temporal_consistency": "0.00016014173",
        "avg_self_similarity": "0.9998654",
        "similarity_range": [
          "0.99961543",
          "1.0000001"
        ]
      },
      "lsl_stream_20250809_175632": {
        "fragment_count": 29,
        "avg_consecutive_similarity": "0.99993885",
        "temporal_consistency": "0.00015104355",
        "avg_self_similarity": "0.99985325",
        "similarity_range": [
          "0.9984005",
          "1.0000001"
        ]
      }
    },
    "fragment_count": 243
  },
  "video_embeddings": {
    "video_info": {
      "lsl_stream_20250809_154545": {
        "indices": [
          0
        ],
        "fragment_count": 1,
        "total_duration": 533.248,
        "video_short": "154545"
      },
      "lsl_stream_20250809_155123": {
        "indices": [
          1
        ],
        "fragment_count": 1,
        "total_duration": 554.336,
        "video_short": "155123"
      },
      "lsl_stream_20250809_155739": {
        "indices": [
          2
        ],
        "fragment_count": 1,
        "total_duration": 541.312,
        "video_short": "155739"
      },
      "lsl_stream_20250809_160350": {
        "indices": [
          3
        ],
        "fragment_count": 1,
        "total_duration": 537.088,
        "video_short": "160350"
      },
      "lsl_stream_20250809_173815": {
        "indices": [
          4
        ],
        "fragment_count": 1,
        "total_duration": 339.68,
        "video_short": "173815"
      },
      "lsl_stream_20250809_174138": {
        "indices": [
          5
        ],
        "fragment_count": 1,
        "total_duration": 598.72,
        "video_short": "174138"
      },
      "lsl_stream_20250809_174635": {
        "indices": [
          6
        ],
        "fragment_count": 1,
        "total_duration": 595.392,
        "video_short": "174635"
      },
      "lsl_stream_20250809_175111": {
        "indices": [
          7
        ],
        "fragment_count": 1,
        "total_duration": 595.84,
        "video_short": "175111"
      },
      "lsl_stream_20250809_175524": {
        "indices": [
          8
        ],
        "fragment_count": 1,
        "total_duration": 110.592,
        "video_short": "175524"
      },
      "lsl_stream_20250809_175632": {
        "indices": [
          9
        ],
        "fragment_count": 1,
        "total_duration": 599.808,
        "video_short": "175632"
      }
    },
    "video_ids": [
      "lsl_stream_20250809_154545",
      "lsl_stream_20250809_155123",
      "lsl_stream_20250809_155739",
      "lsl_stream_20250809_160350",
      "lsl_stream_20250809_173815",
      "lsl_stream_20250809_174138",
      "lsl_stream_20250809_174635",
      "lsl_stream_20250809_175111",
      "lsl_stream_20250809_175524",
      "lsl_stream_20250809_175632"
    ],
    "video_short_names": [
      "154545",
      "155123",
      "155739",
      "160350",
      "173815",
      "174138",
      "174635",
      "175111",
      "175524",
      "175632"
    ],
    "full_similarity_matrix": "[[0.99999994 0.0229386  0.9736915  0.99447995 0.18058485 0.13618083\n  0.06155881 0.65807843 0.41269478 0.8446617 ]\n [0.0229386  1.         0.03010739 0.02743773 0.66229117 0.5781545\n  0.326281   0.27224922 0.29325897 0.14840876]\n [0.9736915  0.03010739 1.         0.95420563 0.27749723 0.22909705\n  0.01923761 0.66814363 0.40330356 0.8947452 ]\n [0.99447995 0.02743773 0.95420563 0.99999994 0.17324212 0.13044897\n  0.14125805 0.7010451  0.47054163 0.8449975 ]\n [0.18058485 0.66229117 0.27749723 0.17324212 1.         0.9839916\n  0.15497026 0.38769928 0.27529132 0.36897656]\n [0.13618083 0.5781545  0.22909705 0.13044897 0.9839916  1.0000001\n  0.10195282 0.3222373  0.21168974 0.29830426]\n [0.06155881 0.326281   0.01923761 0.14125805 0.15497026 0.10195282\n  0.9999999  0.72152185 0.8817994  0.37005505]\n [0.65807843 0.27224922 0.66814363 0.7010451  0.38769928 0.3222373\n  0.72152185 0.99999994 0.92691433 0.8945412 ]\n [0.41269478 0.29325897 0.40330356 0.47054163 0.27529132 0.21168974\n  0.8817994  0.92691433 0.99999994 0.7221941 ]\n [0.8446617  0.14840876 0.8947452  0.8449975  0.36897656 0.29830426\n  0.37005505 0.8945412  0.7221941  1.        ]]",
    "video_similarity_matrix": [
      [
        0.9999999403953552,
        0.022938599810004234,
        0.9736915230751038,
        0.9944799542427063,
        0.1805848479270935,
        0.1361808329820633,
        0.0615588054060936,
        0.6580784320831299,
        0.4126947820186615,
        0.8446617126464844
      ],
      [
        0.022938599810004234,
        1.0,
        0.030107391998171806,
        0.0274377278983593,
        0.6622911691665649,
        0.5781545042991638,
        0.32628101110458374,
        0.2722492218017578,
        0.2932589650154114,
        0.14840875566005707
      ],
      [
        0.9736915230751038,
        0.030107391998171806,
        1.0,
        0.9542056322097778,
        0.27749723196029663,
        0.22909705340862274,
        0.019237607717514038,
        0.668143630027771,
        0.4033035635948181,
        0.8947451710700989
      ],
      [
        0.9944799542427063,
        0.0274377278983593,
        0.9542056322097778,
        0.9999999403953552,
        0.17324212193489075,
        0.13044896721839905,
        0.14125804603099823,
        0.7010450959205627,
        0.4705416262149811,
        0.8449975252151489
      ],
      [
        0.1805848479270935,
        0.6622911691665649,
        0.27749723196029663,
        0.17324212193489075,
        1.0,
        0.9839916229248047,
        0.15497025847434998,
        0.38769927620887756,
        0.2752913236618042,
        0.36897656321525574
      ],
      [
        0.1361808329820633,
        0.5781545042991638,
        0.22909705340862274,
        0.13044896721839905,
        0.9839916229248047,
        1.0000001192092896,
        0.10195282101631165,
        0.3222373127937317,
        0.21168974041938782,
        0.2983042597770691
      ],
      [
        0.0615588054060936,
        0.32628101110458374,
        0.019237607717514038,
        0.14125804603099823,
        0.15497025847434998,
        0.10195282101631165,
        0.9999998807907104,
        0.7215218544006348,
        0.8817993998527527,
        0.37005504965782166
      ],
      [
        0.6580784320831299,
        0.2722492218017578,
        0.668143630027771,
        0.7010450959205627,
        0.38769927620887756,
        0.3222373127937317,
        0.7215218544006348,
        0.9999999403953552,
        0.9269143342971802,
        0.8945412039756775
      ],
      [
        0.4126947820186615,
        0.2932589650154114,
        0.4033035635948181,
        0.4705416262149811,
        0.2752913236618042,
        0.21168974041938782,
        0.8817993998527527,
        0.9269143342971802,
        0.9999999403953552,
        0.7221940755844116
      ],
      [
        0.8446617126464844,
        0.14840875566005707,
        0.8947451710700989,
        0.8449975252151489,
        0.36897656321525574,
        0.2983042597770691,
        0.37005504965782166,
        0.8945412039756775,
        0.7221940755844116,
        1.0
      ]
    ],
    "temporal_analysis": {},
    "fragment_count": 10
  }
};
        let currentDb = Object.keys(analysisData)[0];
        
        document.addEventListener('DOMContentLoaded', function() {
            updateAnalysis();
        });
        
        function updateAnalysis() {
            currentDb = document.getElementById('database-select').value;
            updateFragmentDistributionTable();
            createCorrectedSimilarityPlot();
            createTemporalConsistencyPlot();
            createFragmentCountPlot();
            createSelfSimilarityPlot();
        }
        
        function updateFragmentDistributionTable() {
            const data = analysisData[currentDb];
            const videoInfo = data.video_info;
            
            let tableHtml = `
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>Video ID</th>
                            <th>Fragment Count</th>
                            <th>Total Duration (s)</th>
                            <th>Avg Fragment Duration</th>
                            <th>Temporal Consistency</th>
                            <th>Self-Similarity</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            Object.keys(videoInfo).forEach(videoId => {
                const info = videoInfo[videoId];
                const temporal = data.temporal_analysis[videoId] || {};
                
                tableHtml += `
                    <tr>
                        <td><strong>${info.video_short}</strong></td>
                        <td>${info.fragment_count}</td>
                        <td>${info.total_duration.toFixed(1)}</td>
                        <td>${(info.total_duration / info.fragment_count).toFixed(1)}s</td>
                        <td>${(temporal.avg_consecutive_similarity || 0).toFixed(3)}</td>
                        <td>${(temporal.avg_self_similarity || 0).toFixed(3)}</td>
                    </tr>
                `;
            });
            
            tableHtml += '</tbody></table>';
            document.getElementById('fragment-distribution-table').innerHTML = tableHtml;
        }
        
        function createCorrectedSimilarityPlot() {
            const data = analysisData[currentDb];
            
            const trace = {
                z: data.video_similarity_matrix,
                x: data.video_short_names,
                y: data.video_short_names,
                type: 'heatmap',
                colorscale: 'Viridis',
                hoverongaps: false,
                hovertemplate: 'Video Y: %{y}<br>Video X: %{x}<br>Similarity: %{z:.4f}<extra></extra>'
            };
            
            const layout = {
                xaxis: {title: 'Video IDs', tickangle: 45},
                yaxis: {title: 'Video IDs'},
                height: 400,
                title: 'Corrected Video-to-Video Similarity Matrix'
            };
            
            Plotly.newPlot('corrected-similarity-plot', [trace], layout, {responsive: true});
        }
        
        function createTemporalConsistencyPlot() {
            const data = analysisData[currentDb];
            const temporal = data.temporal_analysis;
            
            const videoIds = Object.keys(temporal);
            
            const trace = {
                x: videoIds.map(id => data.video_info[id].video_short),
                y: videoIds.map(id => temporal[id].avg_consecutive_similarity),
                type: 'bar',
                marker: {color: '#667eea'},
                name: 'Temporal Consistency'
            };
            
            const layout = {
                xaxis: {title: 'Video ID', tickangle: 45},
                yaxis: {title: 'Avg Consecutive Similarity', range: [0, 1]},
                height: 400,
                title: 'How Similar Are Consecutive Fragments?'
            };
            
            Plotly.newPlot('temporal-consistency-plot', [trace], layout, {responsive: true});
        }
        
        function createFragmentCountPlot() {
            const data = analysisData[currentDb];
            const videoInfo = data.video_info;
            
            const videoIds = Object.keys(videoInfo);
            
            const trace = {
                x: videoIds.map(id => videoInfo[id].video_short),
                y: videoIds.map(id => videoInfo[id].fragment_count),
                type: 'bar',
                marker: {color: '#28a745'},
                name: 'Fragment Count'
            };
            
            const layout = {
                xaxis: {title: 'Video ID', tickangle: 45},
                yaxis: {title: 'Number of Fragments'},
                height: 400,
                title: 'Fragment Distribution Across Videos'
            };
            
            Plotly.newPlot('fragment-count-plot', [trace], layout, {responsive: true});
        }
        
        function createSelfSimilarityPlot() {
            const data = analysisData[currentDb];
            const temporal = data.temporal_analysis;
            
            const videoIds = Object.keys(temporal);
            
            const trace = {
                x: videoIds.map(id => data.video_info[id].video_short),
                y: videoIds.map(id => temporal[id].avg_self_similarity),
                type: 'bar',
                marker: {color: '#dc3545'},
                name: 'Self-Similarity'
            };
            
            const layout = {
                xaxis: {title: 'Video ID', tickangle: 45},
                yaxis: {title: 'Average Self-Similarity', range: [0, 1]},
                height: 400,
                title: 'Internal Coherence Per Video'
            };
            
            Plotly.newPlot('self-similarity-plot', [trace], layout, {responsive: true});
        }
    </script>
</body>
</html>
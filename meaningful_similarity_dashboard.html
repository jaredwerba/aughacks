<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meaningful EEG Similarity Analysis</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .container { max-width: 1800px; margin: 0 auto; padding: 20px; }
        .header { background: rgba(255,255,255,0.95); border-radius: 20px; padding: 30px; margin-bottom: 30px; text-align: center; }
        .header h1 { color: #667eea; font-size: 2.5em; margin-bottom: 10px; }
        .correction-section { background: #fff3cd; border-left: 4px solid #ffc107; padding: 20px; margin: 20px 0; border-radius: 5px; }
        .interpretation-section { background: #d4edda; border-left: 4px solid #28a745; padding: 20px; margin: 20px 0; border-radius: 5px; }
        .controls { background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        .viz-section { background: rgba(255,255,255,0.95); border-radius: 20px; padding: 25px; margin-bottom: 25px; }
        .section-title { font-size: 1.5em; font-weight: 600; color: #667eea; margin-bottom: 20px; }
        .viz-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 25px; }
        .viz-container { background: #f8f9fa; border-radius: 10px; padding: 20px; }
        .viz-title { font-size: 1.1em; font-weight: 600; margin-bottom: 15px; text-align: center; }
        .control-group select { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; }
        .interpretation-box { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-brain"></i> Meaningful EEG Similarity Analysis</h1>
            <p>Corrected Interpretation of Video IDs and Similarity Metrics</p>
        </div>
        
        <div class="correction-section">
            <h3>🔧 Corrections Applied:</h3>
            <p><strong>1. Video IDs as Categorical Labels:</strong> Video IDs (175k, 160k, etc.) are now treated as categorical labels, not numeric values.</p>
            <p><strong>2. Clear Similarity Definition:</strong> Explicitly defined what similarity means for each database type.</p>
            <p><strong>3. Meaningful Interpretations:</strong> Added clear explanations of what each similarity metric represents.</p>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label><i class="fas fa-database"></i> Database:</label>
                <select id="database-select" onchange="updateAnalysis()">
                    <option value="video_embeddings_5s">5s Fragments</option>
<option value="video_embeddings_20s">20s Fragments</option>
<option value="video_embeddings">Full Videos</option>
                </select>
            </div>
        </div>
        
        <div id="interpretation-section" class="interpretation-section">
            <!-- Dynamic interpretation will be populated here -->
        </div>
        
        <div class="viz-section">
            <div class="section-title"><i class="fas fa-chart-line"></i> Similarity Analysis</div>
            <div id="similarity-visualization">
                <!-- Dynamic visualizations will be populated here -->
            </div>
        </div>
    </div>

    <script>
        const analysisData = {
  "video_embeddings_5s": {
    "type": "fragment_analysis",
    "video_ids": [
      "154545",
      "155123",
      "155739",
      "160350",
      "173815",
      "174138",
      "174635",
      "175111",
      "175524",
      "175632"
    ],
    "intra_video_similarities": {
      "lsl_stream_20250809_154545": {
        "avg_consecutive_similarity": "0.9435325",
        "avg_overall_similarity": "0.91251314",
        "similarity_std": "0.14912537",
        "fragment_count": 106
      },
      "lsl_stream_20250809_155123": {
        "avg_consecutive_similarity": "0.914217",
        "avg_overall_similarity": "0.86869806",
        "similarity_std": "0.24614263",
        "fragment_count": 110
      },
      "lsl_stream_20250809_155739": {
        "avg_consecutive_similarity": "0.9476025",
        "avg_overall_similarity": "0.8920237",
        "similarity_std": "0.14455782",
        "fragment_count": 108
      },
      "lsl_stream_20250809_160350": {
        "avg_consecutive_similarity": "0.9651365",
        "avg_overall_similarity": "0.93735904",
        "similarity_std": "0.17581987",
        "fragment_count": 107
      },
      "lsl_stream_20250809_173815": {
        "avg_consecutive_similarity": "0.84881735",
        "avg_overall_similarity": "0.69182366",
        "similarity_std": "0.3301368",
        "fragment_count": 67
      },
      "lsl_stream_20250809_174138": {
        "avg_consecutive_similarity": "0.77219415",
        "avg_overall_similarity": "0.6293872",
        "similarity_std": "0.326205",
        "fragment_count": 119
      },
      "lsl_stream_20250809_174635": {
        "avg_consecutive_similarity": "0.8974065",
        "avg_overall_similarity": "0.45295444",
        "similarity_std": "0.37613633",
        "fragment_count": 119
      },
      "lsl_stream_20250809_175111": {
        "avg_consecutive_similarity": "0.973015",
        "avg_overall_similarity": "0.9581437",
        "similarity_std": "0.07599391",
        "fragment_count": 119
      },
      "lsl_stream_20250809_175524": {
        "avg_consecutive_similarity": "0.999136",
        "avg_overall_similarity": "0.9988221",
        "similarity_std": "0.0025891957",
        "fragment_count": 22
      },
      "lsl_stream_20250809_175632": {
        "avg_consecutive_similarity": "0.9997741",
        "avg_overall_similarity": "0.99974173",
        "similarity_std": "0.0008780875",
        "fragment_count": 119
      }
    },
    "inter_video_similarity_matrix": [
      [
        1.0,
        0.07110585272312164,
        0.7733588218688965,
        0.99517822265625,
        0.06177026033401489,
        0.053389184176921844,
        0.8781070113182068,
        0.9116469621658325,
        0.8503531217575073,
        0.8464294075965881
      ],
      [
        0.07110585272312164,
        1.0,
        0.07775763422250748,
        0.0705147460103035,
        0.9563589692115784,
        0.8725154399871826,
        0.3304694592952728,
        0.3203081786632538,
        0.3124823570251465,
        0.31244006752967834
      ],
      [
        0.7733588218688965,
        0.07775763422250748,
        0.9999998807907104,
        0.7106890082359314,
        0.0663815587759018,
        0.05210186168551445,
        0.6454190611839294,
        0.6610457301139832,
        0.6447235345840454,
        0.6433972120285034
      ],
      [
        0.99517822265625,
        0.0705147460103035,
        0.7106890082359314,
        1.0,
        0.060890041291713715,
        0.052915308624506,
        0.8870773315429688,
        0.9195735454559326,
        0.8566709160804749,
        0.8526830673217773
      ],
      [
        0.06177026033401489,
        0.9563589692115784,
        0.0663815587759018,
        0.060890041291713715,
        0.9999998807907104,
        0.9770084023475647,
        0.24052292108535767,
        0.26497703790664673,
        0.2407309114933014,
        0.24048425257205963
      ],
      [
        0.053389184176921844,
        0.8725154399871826,
        0.05210186168551445,
        0.052915308624506,
        0.9770084023475647,
        0.9999999403953552,
        0.1683310717344284,
        0.21584314107894897,
        0.1828683614730835,
        0.18260805308818817
      ],
      [
        0.8781070113182068,
        0.3304694592952728,
        0.6454190611839294,
        0.8870773315429688,
        0.24052292108535767,
        0.1683310717344284,
        0.9999999403953552,
        0.9700411558151245,
        0.9663946628570557,
        0.9657189846038818
      ],
      [
        0.9116469621658325,
        0.3203081786632538,
        0.6610457301139832,
        0.9195735454559326,
        0.26497703790664673,
        0.21584314107894897,
        0.9700411558151245,
        1.0,
        0.9848669171333313,
        0.9832014441490173
      ],
      [
        0.8503531217575073,
        0.3124823570251465,
        0.6447235345840454,
        0.8566709160804749,
        0.2407309114933014,
        0.1828683614730835,
        0.9663946628570557,
        0.9848669171333313,
        1.0,
        0.9999489784240723
      ],
      [
        0.8464294075965881,
        0.31244006752967834,
        0.6433972120285034,
        0.8526830673217773,
        0.24048425257205963,
        0.18260805308818817,
        0.9657189846038818,
        0.9832014441490173,
        0.9999489784240723,
        1.0000001192092896
      ]
    ],
    "interpretation": {
      "intra_video": "Temporal consistency within each video (how similar consecutive fragments are)",
      "inter_video": "Cross-video similarity (how similar different videos are overall)",
      "meaningful_because": "Fragments allow temporal analysis within videos and comparison across videos"
    }
  },
  "video_embeddings_20s": {
    "type": "fragment_analysis",
    "video_ids": [
      "154545",
      "155123",
      "155739",
      "160350",
      "173815",
      "174138",
      "174635",
      "175111",
      "175524",
      "175632"
    ],
    "intra_video_similarities": {
      "lsl_stream_20250809_154545": {
        "avg_consecutive_similarity": "0.9086209",
        "avg_overall_similarity": "0.8910771",
        "similarity_std": "0.1907573",
        "fragment_count": 26
      },
      "lsl_stream_20250809_155123": {
        "avg_consecutive_similarity": "0.8563422",
        "avg_overall_similarity": "0.8476722",
        "similarity_std": "0.28839043",
        "fragment_count": 27
      },
      "lsl_stream_20250809_155739": {
        "avg_consecutive_similarity": "0.9514713",
        "avg_overall_similarity": "0.9178225",
        "similarity_std": "0.10028769",
        "fragment_count": 27
      },
      "lsl_stream_20250809_160350": {
        "avg_consecutive_similarity": "0.9570909",
        "avg_overall_similarity": "0.9235053",
        "similarity_std": "0.23113264",
        "fragment_count": 26
      },
      "lsl_stream_20250809_173815": {
        "avg_consecutive_similarity": "0.8675696",
        "avg_overall_similarity": "0.7447694",
        "similarity_std": "0.29517922",
        "fragment_count": 16
      },
      "lsl_stream_20250809_174138": {
        "avg_consecutive_similarity": "0.8278845",
        "avg_overall_similarity": "0.6934763",
        "similarity_std": "0.30043596",
        "fragment_count": 29
      },
      "lsl_stream_20250809_174635": {
        "avg_consecutive_similarity": "0.8641543",
        "avg_overall_similarity": "0.46968213",
        "similarity_std": "0.36806652",
        "fragment_count": 29
      },
      "lsl_stream_20250809_175111": {
        "avg_consecutive_similarity": "0.97343963",
        "avg_overall_similarity": "0.96453273",
        "similarity_std": "0.06268075",
        "fragment_count": 29
      },
      "lsl_stream_20250809_175524": {
        "avg_consecutive_similarity": "0.99989057",
        "avg_overall_similarity": "0.9998654",
        "similarity_std": "0.00014163063",
        "fragment_count": 5
      },
      "lsl_stream_20250809_175632": {
        "avg_consecutive_similarity": "0.99993885",
        "avg_overall_similarity": "0.99985325",
        "similarity_std": "0.00037525917",
        "fragment_count": 29
      }
    },
    "inter_video_similarity_matrix": [
      [
        0.9999998807907104,
        0.058812323957681656,
        0.6947638392448425,
        0.9509749412536621,
        0.0459442138671875,
        0.04905736446380615,
        0.7623412013053894,
        0.8145594596862793,
        0.7665855288505554,
        0.7654522657394409
      ],
      [
        0.058812323957681656,
        1.0,
        0.02751089632511139,
        0.06554900109767914,
        0.9547039270401001,
        0.8714622259140015,
        0.3259476125240326,
        0.3152827024459839,
        0.30546247959136963,
        0.30596625804901123
      ],
      [
        0.6947638392448425,
        0.02751089632511139,
        1.000000238418579,
        0.4478839933872223,
        0.039539583027362823,
        0.03061741404235363,
        0.23322823643684387,
        0.2721613049507141,
        0.3020502030849457,
        0.3021233379840851
      ],
      [
        0.9509749412536621,
        0.06554900109767914,
        0.4478839933872223,
        0.9999997615814209,
        0.046697355806827545,
        0.052195239812135696,
        0.866269052028656,
        0.9133334755897522,
        0.8442932367324829,
        0.8429152965545654
      ],
      [
        0.0459442138671875,
        0.9547039270401001,
        0.039539583027362823,
        0.046697355806827545,
        1.0,
        0.9760868549346924,
        0.22516128420829773,
        0.25201642513275146,
        0.22636355459690094,
        0.22684352099895477
      ],
      [
        0.04905736446380615,
        0.8714622259140015,
        0.03061741404235363,
        0.052195239812135696,
        0.9760868549346924,
        1.0,
        0.1654984951019287,
        0.2179757058620453,
        0.18162667751312256,
        0.1820565015077591
      ],
      [
        0.7623412013053894,
        0.3259476125240326,
        0.23322823643684387,
        0.866269052028656,
        0.22516128420829773,
        0.1654984951019287,
        1.0,
        0.9724535346031189,
        0.9594357013702393,
        0.9591079950332642
      ],
      [
        0.8145594596862793,
        0.3152827024459839,
        0.2721613049507141,
        0.9133334755897522,
        0.25201642513275146,
        0.2179757058620453,
        0.9724535346031189,
        0.9999999403953552,
        0.9767049551010132,
        0.9760904312133789
      ],
      [
        0.7665855288505554,
        0.30546247959136963,
        0.3020502030849457,
        0.8442932367324829,
        0.22636355459690094,
        0.18162667751312256,
        0.9594357013702393,
        0.9767049551010132,
        1.0,
        0.9999948143959045
      ],
      [
        0.7654522657394409,
        0.30596625804901123,
        0.3021233379840851,
        0.8429152965545654,
        0.22684352099895477,
        0.1820565015077591,
        0.9591079950332642,
        0.9760904312133789,
        0.9999948143959045,
        1.0
      ]
    ],
    "interpretation": {
      "intra_video": "Temporal consistency within each video (how similar consecutive fragments are)",
      "inter_video": "Cross-video similarity (how similar different videos are overall)",
      "meaningful_because": "Fragments allow temporal analysis within videos and comparison across videos"
    }
  },
  "video_embeddings": {
    "type": "multi_video",
    "video_ids": [
      "154545",
      "155123",
      "155739",
      "160350",
      "173815",
      "174138",
      "174635",
      "175111",
      "175524",
      "175632"
    ],
    "similarity_matrix": [
      [
        0.9999999403953552,
        0.022938599810004234,
        0.9736915230751038,
        0.9944799542427063,
        0.1805848479270935,
        0.1361808329820633,
        0.0615588054060936,
        0.6580784320831299,
        0.4126947820186615,
        0.8446617126464844
      ],
      [
        0.022938599810004234,
        1.0,
        0.030107391998171806,
        0.0274377278983593,
        0.6622911691665649,
        0.5781545042991638,
        0.32628101110458374,
        0.2722492218017578,
        0.2932589650154114,
        0.14840875566005707
      ],
      [
        0.9736915230751038,
        0.030107391998171806,
        1.0,
        0.9542056322097778,
        0.27749723196029663,
        0.22909705340862274,
        0.019237607717514038,
        0.668143630027771,
        0.4033035635948181,
        0.8947451710700989
      ],
      [
        0.9944799542427063,
        0.0274377278983593,
        0.9542056322097778,
        0.9999999403953552,
        0.17324212193489075,
        0.13044896721839905,
        0.14125804603099823,
        0.7010450959205627,
        0.4705416262149811,
        0.8449975252151489
      ],
      [
        0.1805848479270935,
        0.6622911691665649,
        0.27749723196029663,
        0.17324212193489075,
        1.0,
        0.9839916229248047,
        0.15497025847434998,
        0.38769927620887756,
        0.2752913236618042,
        0.36897656321525574
      ],
      [
        0.1361808329820633,
        0.5781545042991638,
        0.22909705340862274,
        0.13044896721839905,
        0.9839916229248047,
        1.0000001192092896,
        0.10195282101631165,
        0.3222373127937317,
        0.21168974041938782,
        0.2983042597770691
      ],
      [
        0.0615588054060936,
        0.32628101110458374,
        0.019237607717514038,
        0.14125804603099823,
        0.15497025847434998,
        0.10195282101631165,
        0.9999998807907104,
        0.7215218544006348,
        0.8817993998527527,
        0.37005504965782166
      ],
      [
        0.6580784320831299,
        0.2722492218017578,
        0.668143630027771,
        0.7010450959205627,
        0.38769927620887756,
        0.3222373127937317,
        0.7215218544006348,
        0.9999999403953552,
        0.9269143342971802,
        0.8945412039756775
      ],
      [
        0.4126947820186615,
        0.2932589650154114,
        0.4033035635948181,
        0.4705416262149811,
        0.2752913236618042,
        0.21168974041938782,
        0.8817993998527527,
        0.9269143342971802,
        0.9999999403953552,
        0.7221940755844116
      ],
      [
        0.8446617126464844,
        0.14840875566005707,
        0.8947451710700989,
        0.8449975252151489,
        0.36897656321525574,
        0.2983042597770691,
        0.37005504965782166,
        0.8945412039756775,
        0.7221940755844116,
        1.0
      ]
    ],
    "interpretation": {
      "similarity": "Global similarity between complete videos",
      "meaningful_because": "Each video represented by single embedding capturing overall neural pattern",
      "diagonal_values": "Always 1.0 (video similar to itself)",
      "off_diagonal": "Cross-video similarities showing content/cognitive pattern overlap"
    }
  }
};
        let currentDb = Object.keys(analysisData)[0];
        
        document.addEventListener('DOMContentLoaded', function() {
            updateAnalysis();
        });
        
        function updateAnalysis() {
            currentDb = document.getElementById('database-select').value;
            updateInterpretation();
            createVisualization();
        }
        
        function updateInterpretation() {
            const data = analysisData[currentDb];
            const interpretation = data.interpretation || {};
            
            let interpretationHtml = `
                <h3>📊 What This Analysis Means:</h3>
                <div class="interpretation-box">
                    <h4>Analysis Type: ${data.type}</h4>
            `;
            
            if (data.type === 'fragment_analysis') {
                interpretationHtml += `
                    <p><strong>Intra-Video Similarity:</strong> ${interpretation.intra_video}</p>
                    <p><strong>Inter-Video Similarity:</strong> ${interpretation.inter_video}</p>
                    <p><strong>Why Meaningful:</strong> ${interpretation.meaningful_because}</p>
                `;
            } else if (data.type === 'single_video') {
                interpretationHtml += `
                    <p><strong>Limitation:</strong> ${interpretation.similarity}</p>
                    <p><strong>Alternative Analysis:</strong> ${interpretation.alternative}</p>
                `;
            } else if (data.type === 'multi_video') {
                interpretationHtml += `
                    <p><strong>Similarity Meaning:</strong> ${interpretation.similarity}</p>
                    <p><strong>Why Meaningful:</strong> ${interpretation.meaningful_because}</p>
                    <p><strong>Diagonal Values:</strong> ${interpretation.diagonal_values}</p>
                    <p><strong>Off-Diagonal Values:</strong> ${interpretation.off_diagonal}</p>
                `;
            }
            
            interpretationHtml += '</div>';
            document.getElementById('interpretation-section').innerHTML = interpretationHtml;
        }
        
        function createVisualization() {
            const data = analysisData[currentDb];
            
            if (data.type === 'fragment_analysis') {
                createFragmentAnalysisViz(data);
            } else if (data.type === 'single_video') {
                createSingleVideoViz(data);
            } else if (data.type === 'multi_video') {
                createMultiVideoViz(data);
            }
        }
        
        function createFragmentAnalysisViz(data) {
            const vizHtml = `
                <div class="viz-grid">
                    <div class="viz-container">
                        <div class="viz-title">🎯 Inter-Video Similarity Matrix</div>
                        <div id="inter-video-plot"></div>
                    </div>
                    <div class="viz-container">
                        <div class="viz-title">⏱️ Temporal Consistency Within Videos</div>
                        <div id="temporal-consistency-plot"></div>
                    </div>
                </div>
            `;
            document.getElementById('similarity-visualization').innerHTML = vizHtml;
            
            // Inter-video similarity heatmap
            const trace1 = {
                z: data.inter_video_similarity_matrix,
                x: data.video_ids,
                y: data.video_ids,
                type: 'heatmap',
                colorscale: 'Viridis',
                hoverongaps: false
            };
            
            Plotly.newPlot('inter-video-plot', [trace1], {
                xaxis: {title: 'Video IDs (Categorical)'},
                yaxis: {title: 'Video IDs (Categorical)'},
                height: 400
            }, {responsive: true});
            
            // Temporal consistency bar chart
            const intraVideoData = data.intra_video_similarities;
            const videoIds = Object.keys(intraVideoData);
            
            const trace2 = {
                x: videoIds.map(id => id.replace('lsl_stream_20250809_', '')),
                y: videoIds.map(id => intraVideoData[id].avg_consecutive_similarity),
                type: 'bar',
                marker: {color: '#667eea'}
            };
            
            Plotly.newPlot('temporal-consistency-plot', [trace2], {
                xaxis: {title: 'Video IDs (Categorical)'},
                yaxis: {title: 'Temporal Consistency', range: [0, 1]},
                height: 400
            }, {responsive: true});
        }
        
        function createSingleVideoViz(data) {
            const vizHtml = `
                <div class="viz-container">
                    <div class="viz-title">📊 Single Video Embedding Analysis</div>
                    <div id="single-video-plot"></div>
                    <p><strong>Note:</strong> Cannot compute similarity with only one video. Showing embedding characteristics instead.</p>
                </div>
            `;
            document.getElementById('similarity-visualization').innerHTML = vizHtml;
            
            const analysis = data.embedding_analysis;
            const trace = {
                x: ['Magnitude', 'Mean', 'Std', 'Min', 'Max', 'Sparsity'],
                y: [analysis.magnitude, analysis.mean, analysis.std, analysis.min, analysis.max, analysis.sparsity],
                type: 'bar',
                marker: {color: '#28a745'}
            };
            
            Plotly.newPlot('single-video-plot', [trace], {
                xaxis: {title: 'Embedding Characteristics'},
                yaxis: {title: 'Values'},
                height: 400
            }, {responsive: true});
        }
        
        function createMultiVideoViz(data) {
            const vizHtml = `
                <div class="viz-container">
                    <div class="viz-title">🎯 Video-to-Video Similarity Matrix</div>
                    <div id="multi-video-plot"></div>
                </div>
            `;
            document.getElementById('similarity-visualization').innerHTML = vizHtml;
            
            const trace = {
                z: data.similarity_matrix,
                x: data.video_ids,
                y: data.video_ids,
                type: 'heatmap',
                colorscale: 'Viridis',
                hoverongaps: false
            };
            
            Plotly.newPlot('multi-video-plot', [trace], {
                xaxis: {title: 'Video IDs (Categorical)'},
                yaxis: {title: 'Video IDs (Categorical)'},
                height: 400
            }, {responsive: true});
        }
    </script>
</body>
</html>